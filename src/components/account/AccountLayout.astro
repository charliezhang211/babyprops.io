---
/**
 * Account Layout Component
 * Shared sidebar navigation for account pages
 */
import type { User } from "@supabase/supabase-js";

interface Props {
    user: User;
    currentPage: "dashboard" | "orders" | "addresses" | "settings";
}

const { user, currentPage } = Astro.props;

// Get user's initials for avatar
const fullName = user.user_metadata?.full_name || user.email || "User";
const initials = fullName
    .split(" ")
    .map((n: string) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2);

const navItems = [
    {
        id: "dashboard",
        label: "Dashboard",
        href: "/account/",
        icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>`,
    },
    {
        id: "orders",
        label: "Order History",
        href: "/account/orders/",
        icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><rect x="8" y="2" width="8" height="4" rx="1" ry="1"/></svg>`,
    },
    {
        id: "addresses",
        label: "Addresses",
        href: "/account/addresses/",
        icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>`,
    },
    {
        id: "settings",
        label: "Settings",
        href: "/account/settings/",
        icon: `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>`,
    },
];
---

<div class="account-layout">
    <aside class="account-sidebar">
        <div class="account-user">
            <div class="account-avatar">{initials}</div>
            <div class="account-user-info">
                <div class="account-user-name">{fullName}</div>
                <div class="account-user-email">{user.email}</div>
            </div>
        </div>

        <nav class="account-nav">
            {
                navItems.map((item) => (
                    <a
                        href={item.href}
                        class={`account-nav-link ${currentPage === item.id ? "active" : ""}`}
                    >
                        <Fragment set:html={item.icon} />
                        {item.label}
                    </a>
                ))
            }

            <div class="account-nav-divider"></div>

            <button class="account-nav-link logout" id="logout-btn">
                <svg
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                >
                    <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                    <polyline points="16 17 21 12 16 7"></polyline>
                    <line x1="21" y1="12" x2="9" y2="12"></line>
                </svg>
                Sign Out
            </button>
        </nav>
    </aside>

    <main class="account-main">
        <slot />
    </main>
</div>

<script>
    import { signOut } from "../../stores/auth";

    document.getElementById("logout-btn")?.addEventListener("click", async () => {
        const result = await signOut();
        if (result.success) {
            window.location.href = "/";
        }
    });
</script>
