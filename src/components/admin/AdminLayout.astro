---
/**
 * Admin Layout Component
 * Provides sidebar navigation for admin pages.
 * Auth check must be done in page frontmatter before rendering this component.
 */
import BaseLayout from "@/components/layout/BaseLayout.astro";
import { siteSettings } from "@/config/site-settings";

interface Props {
    title: string;
    currentPage?: "dashboard" | "orders" | "coupons" | "reviews";
    userEmail?: string;
}

const { title, currentPage = "dashboard", userEmail } = Astro.props;

// Navigation items
const navItems = [
    { id: "dashboard", label: "Dashboard", href: "/admin/", icon: "grid" },
    { id: "orders", label: "Orders", href: "/admin/orders/", icon: "package" },
    { id: "coupons", label: "Coupons", href: "/admin/coupons/", icon: "tag" },
    { id: "reviews", label: "Reviews", href: "/admin/reviews/", icon: "star" },
];

const meta = {
    title: `${title} | Admin | ${siteSettings.siteName}`,
    description: "Admin dashboard",
    noindex: true,
};
---

<BaseLayout {meta} hideHeader hideFooter hideWhatsApp>
    <div class="admin-layout">
        <!-- Sidebar -->
        <aside class="admin-sidebar">
            <div class="admin-sidebar-header">
                <a href="/admin/" class="admin-logo">
                    <span class="admin-logo-icon">⚙️</span>
                    <span class="admin-logo-text">Admin</span>
                </a>
            </div>

            <nav class="admin-nav">
                {
                    navItems.map((item) => (
                        <a
                            href={item.href}
                            class={`admin-nav-item ${currentPage === item.id ? "active" : ""}`}
                        >
                            {item.icon === "grid" && (
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    class="admin-nav-icon"
                                >
                                    <rect x="3" y="3" width="7" height="7" />
                                    <rect x="14" y="3" width="7" height="7" />
                                    <rect x="14" y="14" width="7" height="7" />
                                    <rect x="3" y="14" width="7" height="7" />
                                </svg>
                            )}
                            {item.icon === "package" && (
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    class="admin-nav-icon"
                                >
                                    <path d="M16.5 9.4l-9-5.19M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z" />
                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96" />
                                    <line x1="12" y1="22.08" x2="12" y2="12" />
                                </svg>
                            )}
                            {item.icon === "tag" && (
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    class="admin-nav-icon"
                                >
                                    <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z" />
                                    <line x1="7" y1="7" x2="7.01" y2="7" />
                                </svg>
                            )}
                            {item.icon === "star" && (
                                <svg
                                    viewBox="0 0 24 24"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="2"
                                    class="admin-nav-icon"
                                >
                                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2" />
                                </svg>
                            )}
                            <span>{item.label}</span>
                        </a>
                    ))
                }
            </nav>

            <div class="admin-sidebar-footer">
                <a href="/" class="admin-back-link">
                    <svg
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        class="admin-nav-icon"
                    >
                        <path d="M19 12H5M12 19l-7-7 7-7"></path>
                    </svg>
                    <span>Back to Site</span>
                </a>
                <div class="admin-user-info">
                    <span class="admin-user-email">{userEmail}</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="admin-main">
            <header class="admin-header">
                <h1 class="admin-page-title">{title}</h1>
            </header>
            <div class="admin-content">
                <slot />
            </div>
        </main>
    </div>
</BaseLayout>

<style>
    .admin-layout {
        display: flex;
        min-height: 100vh;
        background: #f8fafc;
    }

    /* Sidebar */
    .admin-sidebar {
        width: 240px;
        background: #1e293b;
        color: #e2e8f0;
        display: flex;
        flex-direction: column;
        position: fixed;
        top: 0;
        left: 0;
        bottom: 0;
        z-index: 50;
    }

    .admin-sidebar-header {
        padding: 1.25rem;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .admin-logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        text-decoration: none;
        color: inherit;
    }

    .admin-logo-icon {
        font-size: 1.5rem;
    }

    .admin-logo-text {
        font-size: 1.25rem;
        font-weight: 700;
        color: #fff;
    }

    /* Navigation */
    .admin-nav {
        flex: 1;
        padding: 1rem 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .admin-nav-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        color: #94a3b8;
        text-decoration: none;
        transition: all 0.15s;
        font-size: 0.9rem;
    }

    .admin-nav-item:hover {
        background: rgba(255, 255, 255, 0.1);
        color: #fff;
    }

    .admin-nav-item.active {
        background: #3b82f6;
        color: #fff;
    }

    .admin-nav-icon {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
    }

    /* Sidebar Footer */
    .admin-sidebar-footer {
        padding: 1rem;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .admin-back-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: #94a3b8;
        text-decoration: none;
        font-size: 0.85rem;
        transition: color 0.15s;
    }

    .admin-back-link:hover {
        color: #fff;
    }

    .admin-user-info {
        padding-top: 0.5rem;
    }

    .admin-user-email {
        font-size: 0.75rem;
        color: #64748b;
        word-break: break-all;
    }

    /* Main Content */
    .admin-main {
        flex: 1;
        margin-left: 240px;
        display: flex;
        flex-direction: column;
    }

    .admin-header {
        background: #fff;
        padding: 1.25rem 2rem;
        border-bottom: 1px solid #e2e8f0;
        position: sticky;
        top: 0;
        z-index: 40;
    }

    .admin-page-title {
        font-size: 1.5rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0;
    }

    .admin-content {
        flex: 1;
        padding: 2rem;
    }

    /* Responsive */
    @media (max-width: 768px) {
        .admin-sidebar {
            width: 100%;
            position: relative;
            height: auto;
        }

        .admin-main {
            margin-left: 0;
        }

        .admin-layout {
            flex-direction: column;
        }

        .admin-nav {
            flex-direction: row;
            overflow-x: auto;
            padding: 0.5rem;
        }

        .admin-nav-item {
            white-space: nowrap;
            padding: 0.5rem 0.75rem;
        }

        .admin-sidebar-footer {
            display: none;
        }
    }
</style>

<!-- Shared styles for all admin manager components (Orders, Coupons, Reviews) -->
<style is:global>
    /* ===== Summary Cards ===== */
    .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .summary-card {
        background: #fff;
        border: 2px solid #e2e8f0;
        border-radius: 0.75rem;
        padding: 1.25rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.15s;
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
    }

    .summary-card:hover {
        border-color: #3b82f6;
    }

    .summary-card.active {
        border-color: #3b82f6;
        background: #eff6ff;
    }

    .summary-card.highlight {
        border-color: #a78bfa;
        background: #f5f3ff;
        cursor: default;
    }

    .summary-value {
        font-size: 1.75rem;
        font-weight: 700;
        color: #1e293b;
    }

    .summary-label {
        font-size: 0.85rem;
        color: #64748b;
        text-transform: capitalize;
    }

    /* ===== Filters / Actions Bar ===== */
    .filters {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1.25rem;
        flex-wrap: wrap;
    }

    .search-form {
        display: flex;
        gap: 0.5rem;
        flex: 1;
        min-width: 200px;
    }

    .search-form input,
    .filters select {
        padding: 0.55rem 0.75rem;
        border: 1px solid #e2e8f0;
        border-radius: 0.375rem;
        font-size: 0.85rem;
        background: #fff;
        color: #334155;
        transition: border-color 0.15s;
    }

    .search-form input {
        flex: 1;
    }

    .search-form input:focus,
    .filters select:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .search-form button {
        padding: 0.55rem 1rem;
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        background: #fff;
        color: #334155;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.15s;
    }

    .search-form button:hover {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }

    .create-btn {
        padding: 0.55rem 1.25rem;
        border-radius: 0.375rem;
        border: none;
        background: #3b82f6;
        color: #fff;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.15s;
    }

    .create-btn:hover {
        background: #2563eb;
    }

    /* ===== Table ===== */
    .orders-table-wrapper {
        background: #fff;
        border-radius: 0.75rem;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .orders-table {
        width: 100%;
        border-collapse: collapse;
    }

    .orders-table th,
    .orders-table td {
        padding: 0.875rem 1rem;
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
    }

    .orders-table th {
        font-size: 0.75rem;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        background: #f8fafc;
        letter-spacing: 0.025em;
    }

    .orders-table td {
        font-size: 0.9rem;
        color: #334155;
    }

    .orders-table tbody tr:hover {
        background: #f8fafc;
    }

    .order-number {
        font-family: monospace;
        font-weight: 600;
        color: #1e293b;
    }

    .order-total {
        font-weight: 600;
        color: #1e293b;
    }

    .order-date {
        font-size: 0.8rem;
        color: #64748b;
        white-space: nowrap;
    }

    .customer-info {
        display: flex;
        flex-direction: column;
        gap: 0.15rem;
    }

    .customer-info small {
        font-size: 0.75rem;
        color: #94a3b8;
    }

    /* ===== Status Badges ===== */
    .status-badge {
        display: inline-block;
        padding: 0.25rem 0.6rem;
        border-radius: 9999px;
        font-size: 0.7rem;
        font-weight: 600;
        color: #fff;
        text-transform: capitalize;
        white-space: nowrap;
    }

    /* ===== Action Buttons ===== */
    .view-btn {
        padding: 0.35rem 0.75rem;
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        background: #fff;
        color: #3b82f6;
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
    }

    .view-btn:hover {
        background: #eff6ff;
        border-color: #bfdbfe;
    }

    .delete-btn {
        padding: 0.35rem 0.75rem;
        border-radius: 0.375rem;
        border: 1px solid #fecaca;
        background: transparent;
        color: #dc2626;
        font-size: 0.8rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.15s;
    }

    .delete-btn:hover {
        background: #fef2f2;
    }

    .update-btn {
        padding: 0.6rem 1.5rem;
        border-radius: 0.5rem;
        border: none;
        background: #3b82f6;
        color: #fff;
        font-size: 0.85rem;
        font-weight: 500;
        cursor: pointer;
        transition: background 0.15s;
        margin-top: 0.5rem;
    }

    .update-btn:hover:not(:disabled) {
        background: #2563eb;
    }

    .update-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
    }

    /* ===== Loading / Empty State ===== */
    .loading,
    .no-data {
        text-align: center;
        padding: 3rem;
        color: #64748b;
        background: #fff;
        border-radius: 0.75rem;
        font-size: 0.95rem;
    }

    .admin-error {
        text-align: center;
        padding: 3rem;
        background: #fff;
        border-radius: 0.75rem;
        color: #dc2626;
    }

    .admin-error button {
        margin-top: 1rem;
        padding: 0.5rem 1.25rem;
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        background: #fff;
        cursor: pointer;
        transition: background 0.15s;
    }

    .admin-error button:hover {
        background: #f1f5f9;
    }

    /* ===== Pagination ===== */
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 1rem;
        margin-top: 1.5rem;
        padding: 1rem;
    }

    .pagination button {
        padding: 0.5rem 1rem;
        border-radius: 0.375rem;
        border: 1px solid #e2e8f0;
        background: #fff;
        color: #334155;
        font-size: 0.85rem;
        cursor: pointer;
        transition: all 0.15s;
    }

    .pagination button:hover:not(:disabled) {
        background: #f1f5f9;
        border-color: #cbd5e1;
    }

    .pagination button:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }

    .pagination span {
        font-size: 0.85rem;
        color: #64748b;
    }

    /* ===== Modal ===== */
    .modal-overlay {
        position: fixed;
        inset: 0;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 100;
        padding: 1rem;
    }

    .modal {
        background: #fff;
        border-radius: 0.75rem;
        padding: 1.5rem;
        width: 100%;
        max-width: 700px;
        position: relative;
        max-height: 90vh;
        overflow-y: auto;
    }

    .modal-close {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        width: 2rem;
        height: 2rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border: none;
        background: #f1f5f9;
        border-radius: 9999px;
        font-size: 1.25rem;
        cursor: pointer;
        color: #64748b;
        transition: all 0.15s;
    }

    .modal-close:hover {
        background: #e2e8f0;
        color: #1e293b;
    }

    .modal h2 {
        font-size: 1.15rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0 0 1.25rem;
    }

    /* ===== Detail Sections (Order Detail) ===== */
    .order-detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }

    .detail-section {
        margin-bottom: 1.25rem;
    }

    .detail-section h3 {
        font-size: 0.9rem;
        font-weight: 600;
        color: #1e293b;
        margin: 0 0 0.75rem;
        padding-bottom: 0.5rem;
        border-bottom: 1px solid #e2e8f0;
    }

    .detail-section p {
        font-size: 0.85rem;
        color: #475569;
        margin: 0.35rem 0;
    }

    .detail-section p strong {
        color: #1e293b;
    }

    /* ===== Items Table (Order Detail) ===== */
    .items-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1rem;
    }

    .items-table th,
    .items-table td {
        padding: 0.6rem 0.75rem;
        text-align: left;
        border-bottom: 1px solid #f1f5f9;
        font-size: 0.85rem;
    }

    .items-table th {
        font-size: 0.7rem;
        font-weight: 600;
        color: #64748b;
        text-transform: uppercase;
        background: #f8fafc;
    }

    .items-table td small {
        color: #94a3b8;
        font-size: 0.75rem;
    }

    .order-totals {
        text-align: right;
        padding: 0.75rem 0;
    }

    .order-totals p {
        font-size: 0.85rem;
        color: #475569;
        margin: 0.3rem 0;
    }

    .order-totals .grand-total {
        font-size: 1rem;
        font-weight: 700;
        color: #1e293b;
        padding-top: 0.5rem;
        border-top: 2px solid #e2e8f0;
        margin-top: 0.5rem;
    }

    /* ===== Update Form ===== */
    .update-form {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
    }

    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
    }

    .update-form label {
        display: flex;
        flex-direction: column;
        gap: 0.35rem;
        font-size: 0.8rem;
        font-weight: 500;
        color: #334155;
    }

    .update-form input,
    .update-form select,
    .update-form textarea {
        padding: 0.55rem 0.75rem;
        border: 1px solid #e2e8f0;
        border-radius: 0.375rem;
        font-size: 0.85rem;
        background: #fff;
        color: #334155;
        font-family: inherit;
        transition: border-color 0.15s;
        box-sizing: border-box;
    }

    .update-form input:focus,
    .update-form select:focus,
    .update-form textarea:focus {
        outline: none;
        border-color: #3b82f6;
        box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .update-form textarea {
        resize: vertical;
        width: 100%;
    }

    /* ===== Responsive (shared) ===== */
    @media (max-width: 768px) {
        .summary-cards {
            grid-template-columns: repeat(2, 1fr);
        }

        .filters {
            flex-direction: column;
        }

        .search-form {
            width: 100%;
        }

        .orders-table-wrapper {
            overflow-x: auto;
        }

        .order-detail-grid {
            grid-template-columns: 1fr;
        }

        .form-row {
            grid-template-columns: 1fr;
        }

        .modal {
            max-width: 100%;
            margin: 0.5rem;
        }
    }
</style>
